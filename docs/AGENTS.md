# TrackTabs - Agent Documentation

> **Project Name:** TrackTabs (codename: "dad")
> **Stack:** Vue 3 + Vite (Frontend) | Express + Ampt (Backend) | Plaid API (Banking)
> **Deployment:** [Ampt](https://www.getampt.com/) serverless platform

---

## Table of Contents

1. [Project Overview](#project-overview)
2. [Tech Stack](#tech-stack)
3. [Project Structure](#project-structure)
4. [Development Workflow](#development-workflow)
5. [Backend Architecture](#backend-architecture)
6. [Frontend Architecture](#frontend-architecture)
7. [Key Features](#key-features)
8. [Common Tasks](#common-tasks)
9. [Agent Instructions](#agent-instructions)

---

## Project Overview

TrackTabs is a personal finance application that integrates with **Plaid** to sync bank accounts and transactions. Users can:

- Connect bank accounts via Plaid Link
- View and categorize transactions
- Create custom rules for automatic categorization
- Organize accounts into groups
- Track spending with tabs

The app uses **Auth0** for authentication.

---

## Tech Stack

### Frontend
| Technology | Purpose |
|------------|---------|
| **Vue 3** | UI framework (Composition API with `<script setup>`) |
| **Vite** | Build tool and dev server |
| **Pinia** | State management |
| **Vue Router** | Client-side routing |
| **TailwindCSS** | Utility-first styling |
| **Lucide Vue** | Icon library |

### Backend
| Technology | Purpose |
|------------|---------|
| **Ampt** | Serverless platform (hosting + data storage) |
| **Express** | API routing |
| **@ampt/data** | Ampt's built-in key-value database |
| **Plaid SDK** | Banking integration |
| **Auth0** | Authentication (JWT validation) |

---

## Project Structure

```
dad/
├── api/                      # Backend code
│   ├── controllers/          # Route handlers (business logic)
│   │   └── plaid/            # Plaid-specific controllers
│   ├── middlewares/          # Express middleware (auth, validation)
│   ├── models/               # Data models (Ampt data schemas)
│   ├── routes/               # Express route definitions
│   ├── services/             # Business logic services
│   │   └── plaid/            # Plaid integration services
│   └── utils/                # Utility functions
│
├── src/                      # Frontend code
│   ├── assets/               # Static assets (fonts, images)
│   ├── css/                  # Global stylesheets
│   ├── features/             # Feature-based modules
│   │   ├── banks/            # Bank account management
│   │   ├── dashboard/        # Main dashboard
│   │   ├── onboarding/       # User onboarding flow
│   │   ├── rule-manager/     # Transaction rule management
│   │   ├── select-date/      # Date picker components
│   │   ├── select-group/     # Group selection components
│   │   └── tabs/             # Tab management
│   ├── router/               # Vue Router configuration
│   ├── shared/               # Shared components and utilities
│   └── stores/               # Pinia stores
│
├── public/                   # Public static assets
├── static/                   # Built frontend (generated by `npm run build`)
├── .instructions/            # Agent task instructions
├── .temp/                    # Temporary task files
├── docs/                     # Documentation
├── tests/                    # Test files
│
├── index.js                  # Express app entry point
├── index.html                # Vite entry HTML
├── vite.config.js            # Vite configuration
├── tailwind.config.js        # Tailwind configuration
└── package.json              # Dependencies and scripts
```

---

## Development Workflow

### Local Development

1. **Start the Ampt sandbox:**
   ```bash
   ampt
   ```
   This connects to your Ampt sandbox environment and syncs your local files.

2. **Build the frontend** (required for Ampt to serve static files):
   ```bash
   npm run build
   ```
   This generates the `static/` directory that Ampt serves.

3. **For frontend development with HMR:**
   ```bash
   npm run dev
   ```
   Uses Vite's dev server (localhost:5173). Note: API calls won't work without proxy configuration.

### Deployment

- **Sandbox URL:** Automatically assigned when running `ampt` (e.g., `https://profound-project-ey0fsb.ampt.app`)
- **Production deploy:** Run `ampt deploy prod` or use the `npm run ampt:publish` script

### Important: Static Files

Ampt serves static files from the `static/` directory by default. The Vite build is configured to output to `./static`. If you see errors like:

```
Error: ENOENT: no such file or directory, open 'static/index.html'
```

Run `npm run build` to generate the static files.

---

## Backend Architecture

### Entry Point (`index.js`)

```javascript
import { http } from '@ampt/sdk';
import express from 'express';
import initApiRoutes from './api/routes';

const app = express();
app.use(express.json());
initApiRoutes(app);
http.useNodeHandler(app);
```

### API Routes (`api/routes/`)

| Route File | Base Path | Purpose |
|------------|-----------|---------|
| `plaid.js` | `/api/plaid/*` | Plaid Link, Items, Transactions |
| `groups.js` | `/api/groups/*` | Account grouping |
| `rules.js` | `/api/rules/*` | Transaction categorization rules |
| `tabs.js` | `/api/tabs/*` | Spending tabs |
| `transactions.js` | `/api/transactions/*` | Transaction CRUD |

### Key Plaid Endpoints

| Method | Endpoint | Purpose |
|--------|----------|---------|
| POST | `/api/plaid/connect/link/:itemId?` | Create Plaid Link token |
| POST | `/api/plaid/exchange/token` | Exchange public token for access token |
| GET | `/api/plaid/items/:_id?` | Get user's connected bank items |
| GET | `/api/plaid/sync/latest/transactions/:itemId` | Sync transactions for an item |
| GET | `/api/plaid/items/:itemId/sync-sessions` | Get sync history |
| POST | `/api/plaid/items/:itemId/revert/:sessionId` | Revert to a previous sync |

### Services Layer (`api/services/plaid/`)

| Service | Purpose |
|---------|---------|
| `syncTransactionsService.js` | Core transaction sync logic with Plaid |
| `syncSessionService.js` | Manages sync session history |
| `transactionsCrudService.js` | Transaction CRUD operations |
| `itemService.js` | Bank item management |
| `accountService.js` | Account management |
| `linkService.js` | Plaid Link token creation |

### Data Models (`api/models/`)

Key models using `@ampt/data`:

| Model | Purpose |
|-------|---------|
| `plaidItems.js` | Connected bank accounts |
| `plaidAccounts.js` | Individual accounts within items |
| `plaidTransactions.js` | Transaction records |
| `plaidGroups.js` | Account groupings |
| `rules.js` | Categorization rules |
| `syncSession.js` | Sync session history |
| `transactionCustomizations.js` | User transaction edits |

---

## Frontend Architecture

### Vue 3 Composition API

All components use `<script setup>` syntax:

```vue
<script setup>
import { ref, computed } from 'vue'
// Component logic
</script>
```

### State Management (Pinia)

Stores are located in `src/stores/`. Access global state like:

```javascript
import { useAppStore } from '@/stores/appStore'
const appStore = useAppStore()
```

### Routing

Routes defined in `src/router/index.js`:

| Path | Component | Description |
|------|-----------|-------------|
| `/` | `Landing.vue` | Landing page |
| `/callback` | `CallbackView.vue` | Auth0 callback |
| `/dashboard/*` | Dashboard routes | Protected app views |
| `/privacy` | `PrivacyPolicy.vue` | Privacy policy |
| `/terms` | `TermsOfService.vue` | Terms of service |

### Feature Modules (`src/features/`)

Each feature is self-contained with its own components:

- **banks/** - Bank connection and account management
- **dashboard/** - Main application dashboard
- **onboarding/** - New user onboarding flow
- **rule-manager/** - Transaction categorization rules
- **tabs/** - Spending tab management

---

## Key Features

### 1. Plaid Integration

- Uses Plaid Link SDK for secure bank connections
- Syncs transactions incrementally using cursors
- Supports sync sessions for history/rollback
- Handles add/modify/remove transaction updates

### 2. Transaction Rules

- Custom rules for automatic transaction categorization
- Rule priority ordering
- Pattern matching on transaction descriptions

### 3. Account Groups

- Organize multiple accounts into logical groups
- Group-level transaction views and summaries

---

## Common Tasks

### Adding a New API Endpoint

1. Create/update controller in `api/controllers/`
2. Add route in `api/routes/{resource}.js`
3. Create service logic in `api/services/` if needed
4. Update model in `api/models/` if new data structures needed

### Adding a New Frontend Feature

1. Create feature folder in `src/features/{feature-name}/`
2. Add components, composables, and views
3. Register routes in `src/router/routes/dashboardRoutes.js`

### Running Tests

```bash
npm test
```

### Updating the Build

```bash
npm run build
```

---

## Agent Instructions

### Task Management

Agent tasks are managed using markdown files:

1. **Task files** are stored in `.temp/` directory
2. **Instructions** for creating tasks are in `.instructions/agent-task-creator.md`
3. **Implementation guidelines** are in `.instructions/implementation-instructions.md`

### Task File Format

```markdown
## Problem
Brief description of what needs to be solved

## Plan
General approach outline

## Tasks
- [ ] 1. First task description
- [ ] 2. Second task description
- [x] 3. Completed task (marked with x)
```

### Implementation Guidelines

1. Read task file carefully before starting
2. Work in small batches (complete 1-3 tasks at a time)
3. Mark tasks as `[x]` immediately upon completion
4. Annotate task file with findings, decisions, and modifications
5. Keep chat responses brief; document in task file instead
6. If clarification is needed, stop and ask before proceeding

### Code Style

- **Backend:** ES modules (`import/export`), async/await
- **Frontend:** Vue 3 Composition API with `<script setup>`
- **Naming:** camelCase for variables/functions, PascalCase for components

### Key Files to Know

| File | Purpose |
|------|---------|
| `api/routes/index.js` | Main API router setup |
| `api/services/plaid/syncTransactionsService.js` | Core sync logic |
| `src/router/index.js` | Frontend routing |
| `vite.config.js` | Build configuration |
| `package.json` | Dependencies and scripts |

---

## Environment Variables

Required environment variables (set in Ampt dashboard or `.env`):

| Variable | Purpose |
|----------|---------|
| `PLAID_CLIENT_ID` | Plaid API client ID |
| `PLAID_SECRET` | Plaid API secret |
| `PLAID_ENV` | Plaid environment (sandbox/development/production) |
| `AUTH0_DOMAIN` | Auth0 tenant domain |
| `AUTH0_CLIENT_ID` | Auth0 application client ID |
| `AUTH0_AUDIENCE` | Auth0 API audience |

---

## Troubleshooting

### "ENOENT: no such file or directory, open 'static/index.html'"

**Solution:** Run `npm run build` to generate the static files.

### Ampt sandbox not syncing

**Solution:** Restart the `ampt` command. Check for errors in the terminal output.

### Auth0 callback issues

**Solution:** Ensure callback URLs are configured in Auth0 dashboard to match your Ampt URL.

---

*Last updated: February 2026*
